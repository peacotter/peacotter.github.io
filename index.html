<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-alpha.12/dist/html2canvas.min.js"></script>
        <link rel="stylesheet" href="main.css">
        <link rel="stylesheet" href="common.css">
    </head>
    <body>
        <div class="text">
            <div class="textarea">
                <textarea id="textarea-01" value="1" cols="50" v-model="message">テスト</textarea>
             </div>
            <div class="button">
                <div class="text_icon"></div>
                <input id="btn-01" type="button" value="ピコートする" onclick="clickBtn5()" />
            </div>
        </div>

    <div id="target">
        <div class="timeline">
            <div class="profile flex">
                <div class="icon">
                    <img src="logo.jpg">
                </div>
                <div class="name">
                    <a class="username">Peacotter</a>
                    <a class="userid">@peacotter</a>
                </div>
            </div>
            <div class="tweet">
                <p class="linehight"><span id="span3"></span></p>
                <a><span class="time" id="text-01"></span></a>
            </div>
        </div>
    </div>


        <div>
			<input id="downloadImageButton" style="width:120px;" type="button" value="画像保存" onclick="getDisplayImage();" >
			<a id="getImage" href=""  style="display:none;"  download="image.png">画像保存</a>
		</div>

    </body>

    <script>
        function clickBtn5() {
          const ta3 = document.getElementById("textarea-01").value;
          document.getElementById("span3").textContent = ta3;
        }

        function formatDate (date, format) {
            format = format.replace(/yyyy/g, date.getFullYear());
            format = format.replace(/MM/g, ('0' + (date.getMonth() + 1)).slice(-1));
            format = format.replace(/dd/g, ('0' + date.getDate()).slice(-2));
            format = format.replace(/HH/g, ('0' + date.getHours()).slice(-1));
            format = format.replace(/mm/g, ('0' + date.getMinutes()).slice(-2));
            format = format.replace(/ss/g, ('0' + date.getSeconds()).slice(-2));
            return format;
        };
    
        document.getElementById('btn-01').addEventListener('click', event => {
            const date = new Date();
            const type3 = formatDate(date, 'yyyy年MM月dd日 HH:mm:ss');
            document.getElementById('text-01').innerHTML = type3;
        });

        let textarea = document.getElementById('textarea-01');
        let clientHeight = textarea.clientHeight;
        textarea.addEventListener('input', ()=>{
        textarea.style.height = clientHeight + 'px';
        let scrollHeight = textarea.scrollHeight;
        textarea.style.height = scrollHeight + 'px';
});

      </script>

<script type="text/javascript">
    function getDisplayImage(){
        //html2canvas実行
        html2canvas(document.getElementById("target")).then(function(canvas) {
            downloadImage(canvas.toDataURL());
        });
    }

    function downloadImage (data) {
        var fname ="testimage.png";
        var encdata= atob(data.replace(/^.*,/, ''));
        var outdata = new Uint8Array(encdata.length);
        for (var i = 0; i < encdata.length; i++) {
            outdata[i] = encdata.charCodeAt(i);
        }
        var blob = new Blob([outdata], ["image/png"]);
            document.getElementById("getImage").href=data;			//base64そのまま設定
            document.getElementById("getImage").download=fname;		//ダウンロードファイル名設定
            document.getElementById("getImage").click(); 			//自動クリック
    }

</script>

</html>
